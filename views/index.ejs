<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Item Drop Eligibility Checker</title>
</head>
<body>
  <h2>Item Drop Eligibility Checker</h2>

  <label for="categorySelect">Select Category:</label>
  <select id="categorySelect">
    <option value="">--Choose a category--</option>
  </select>

  <br><br>

  <label for="itemSelect">Select Item:</label>
  <select id="itemSelect" disabled>
    <option value="">--Choose an item--</option>
  </select>

  <br><br>

  <div id="result"></div>

  <script>
    let categories = [];

    fetch("/categories")
      .then(res => res.json())
      .then(data => {
        categories = data;
        const categorySelect = document.getElementById("categorySelect");

        data.forEach(cat => {
          const opt = document.createElement("option");
          opt.value = cat.id;
          opt.textContent = cat.name;
          categorySelect.appendChild(opt);
        });
      });

    document.getElementById("categorySelect").addEventListener("change", function () {
      const selectedCategory = categories.find(cat => cat.id === this.value);
      const itemSelect = document.getElementById("itemSelect");
      itemSelect.innerHTML = "<option value=''>--Choose an item--</option>";
      itemSelect.disabled = !selectedCategory;

      if (selectedCategory && selectedCategory.items) {
        selectedCategory.items.forEach(item => {
          const opt = document.createElement("option");
          opt.value = item.id;
          opt.textContent = item.name;
          itemSelect.appendChild(opt);
        });
      }
    });

    document.getElementById("itemSelect").addEventListener("change", function () {
      const categoryId = document.getElementById("categorySelect").value;
      const itemId = this.value;
      const result = document.getElementById("result");

      if (!categoryId || !itemId) {
        result.textContent = "Please select both category and item.";
        return;
      }

      fetch(`/eligible-members/${categoryId}/${itemId}`)
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) {
            result.innerHTML = `<p><strong>No members</strong> meet the attendance requirement for this item.</p>`;
          } else {
            result.innerHTML = `
              <p><strong>Eligible Members for "${this.options[this.selectedIndex].text}":</strong></p>
              <ul>
                ${data.map(m => `<li>${m.name}</li>`).join("")}
              </ul>
            `;
          }
        });
    });
  </script>
</body>
</html>
